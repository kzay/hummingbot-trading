name: ai-trend-weekly-retrain

on:
  workflow_dispatch:
  schedule:
    - cron: "0 4 * * 1"

jobs:
  retrain:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install ccxt pandas pandas-ta scikit-learn torch

      - name: Train AI trend models
        run: |
          python hbot/scripts/analysis/train_ai_trend_following_v1.py \
            --exchange binance \
            --symbol BTC/USDT \
            --timeframe 1h \
            --years 5 \
            --epochs 20 \
            --output-dir hbot/data/models/ai_trend_following_v1

      - name: Upload model artifacts
        uses: actions/upload-artifact@v4
        with:
          name: ai-trend-following-v1-models
          path: |
            hbot/data/models/ai_trend_following_v1/lstm_trend.pt
            hbot/data/models/ai_trend_following_v1/rf_position_sizer.pkl
            hbot/data/models/ai_trend_following_v1/training_metrics.json
