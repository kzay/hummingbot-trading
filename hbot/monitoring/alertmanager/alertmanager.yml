# ============================================
# Alertmanager Configuration
# ============================================

global:
  resolve_timeout: 5m

route:
  group_by: ["alertname", "severity"]
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 4h
  receiver: "default"

  routes:
    - match:
        severity: critical
      receiver: "critical"
      repeat_interval: 1h

receivers:
  - name: "default"
    webhook_configs:
      - url: "http://alert-webhook-sink:19093/alert"
        send_resolved: true

  - name: "critical"
    webhook_configs:
      - url: "http://alert-webhook-sink:19093/alert"
        send_resolved: true
    # Telegram alerts — set TELEGRAM_BOT_TOKEN and TELEGRAM_CHAT_ID in .env.
    # To get these:
    #   1. Message @BotFather on Telegram → /newbot → copy the token.
    #   2. Add your bot to a group (or DM it), then visit
    #      https://api.telegram.org/bot<TOKEN>/getUpdates to find the chat_id.
    # Uncomment below once both env vars are set.
    # telegram_configs:
    #   - bot_token: "${TELEGRAM_BOT_TOKEN}"
    #     chat_id: ${TELEGRAM_CHAT_ID}
    #     parse_mode: "HTML"
    #     message: |
    #       <b>{{ .GroupLabels.alertname }}</b> [{{ .GroupLabels.severity }}]
    #       {{ range .Alerts }}{{ .Annotations.description }}
    #       {{ end }}
    #     send_resolved: true

inhibit_rules:
  - source_match:
      severity: "critical"
    target_match:
      severity: "warning"
    equal: ["alertname", "instance"]
