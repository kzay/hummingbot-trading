# ============================================
# Alertmanager Configuration
# ============================================

global:
  resolve_timeout: 5m

route:
  group_by: ["alertname", "severity"]
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 4h
  receiver: "default"

  routes:
    - match:
        severity: critical
      receiver: "critical"
      repeat_interval: 1h

receivers:
  - name: "default"
    webhook_configs:
      - url: "http://alert-webhook-sink:19093/alert"
        send_resolved: true

  - name: "critical"
    webhook_configs:
      - url: "http://alert-webhook-sink:19093/alert"
        send_resolved: true
    # slack_configs are intentionally disabled when SLACK_WEBHOOK_URL is not set.
    # Alertmanager rejects api_url: "" (empty env var) with "unsupported scheme".
    # To enable Slack alerts: set SLACK_WEBHOOK_URL in .env and uncomment below.
    # slack_configs:
    #   - api_url: "${SLACK_WEBHOOK_URL}"
    #     channel: "${SLACK_ALERT_CHANNEL:-#trading-alerts}"
    #     title: "{{ .GroupLabels.alertname }} [{{ .GroupLabels.severity }}]"
    #     text: "{{ range .Alerts }}{{ .Annotations.description }}\n{{ end }}"
    #     send_resolved: true

inhibit_rules:
  - source_match:
      severity: "critical"
    target_match:
      severity: "warning"
    equal: ["alertname", "instance"]
